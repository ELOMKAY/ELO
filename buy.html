<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFI Go - Buy Ticket</title>
    <style>
        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #00796b;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .lock-screen h2 {
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .passcode-input {
            padding: 10px;
            font-size: 18px;
            margin-bottom: 20px;
            width: 200px;
            text-align: center;
            border: none;
            border-radius: 4px;
        }
        
        .passcode-submit {
            padding: 10px 20px;
            background-color: #5c068c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .passcode-error {
            color: #ffcccc;
            margin-top: 10px;
            display: none;
        }

        .update-alert {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .update-alert-content {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .update-alert h2 {
            color: #5c068c;
            margin-top: 0;
            font-size: 22px;
        }

        .update-alert ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        .update-alert li {
            margin-bottom: 8px;
        }

        .update-alert-checkbox {
            margin: 15px 0;
            display: flex;
            align-items: center;
        }

        .update-alert-checkbox input {
            margin-right: 10px;
        }

        .update-alert-button {
            background-color: #5c068c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .buy-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            text-align: center;
            padding-bottom: 80px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            position: relative;
            display: none;
        }

        .header {
            background-color: #00796b;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header span {
            flex: 1;
            text-align: center;
        }

        .exit-arrow {
            width: 20px;
            height: 20px;
            position: absolute;
            left: 15px;
            filter: brightness(0) invert(1);
            cursor: pointer;
        }

        .search-container {
            margin: 15px auto;
            width: 90%;
            max-width: 500px;
        }

        .search-container input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .stop-selection {
            margin: 15px auto;
            width: 90%;
            max-width: 500px;
        }

        .input-group {
            margin-bottom: 15px;
            text-align: left;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            color: #00453c;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .input-group::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: #5c068c;
            transition: width 0.3s ease;
        }

        .input-group.input-focused::after {
            width: 100%;
        }

        .input-group.input-complete::after {
            width: 100%;
            background-color: #5c068c;
            animation: fillBar 0.5s ease-out forwards;
        }

        @keyframes fillBar {
            from { width: 0; }
            to { width: 100%; }
        }

        .suggested-stops {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }

        .stop-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stop-item:hover {
            background-color: #f5f5f5;
        }

        .stop-item .star {
            color: #ccc;
            cursor: pointer;
        }

        .stop-item .star.favorite {
            color: #5c068c;
        }

        .bus-selection {
            margin: 15px auto;
            width: 90%;
            max-width: 500px;
            text-align: left;
        }

        .bus-selection label {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            color: #00453c;
            font-weight: bold;
        }

        .bus-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .bus-option {
            background-color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            position: relative;
        }

        .bus-option.selected {
            background-color: #00796b;
            color: white;
        }

        .bus-option.favorite {
            border: 2px solid #5c068c;
        }

        .bus-option.favorite.selected {
            background-color: #5c068c;
            color: white;
            border-color: #5c068c;
        }

        .bus-option.hidden {
            display: none;
        }

        .favorites-section {
            margin-bottom: 15px;
            border-bottom: 2px solid #5c068c;
            padding-bottom: 8px;
        }

        .favorites-section h3 {
            color: #5c068c;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .price-display {
            font-size: 16px;
            margin: 15px 0;
            color: #5c068c;
            font-weight: bold;
            display: none;
        }

        .save-btn {
            background-color: #5c068c;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .save-btn:hover {
            background-color: #4a056e;
        }

        .footer {
            display: flex;
            justify-content: space-around;
            padding: 8px;
            border-top: 1px solid #ddd;
            background-color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: none;
            height: 60px;
        }

        .footer button {
            background: none;
            border: none;
            font-size: 14px;
            color: #585858;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
        }

        .footer button.active {
            color: #006f5f;
        }

        .footer button img {
            width: 30px;
            height: 30px;
            margin-bottom: 3px;
            border-radius: 50%;
            object-fit: cover;
        }

        .footer button:first-child img {
            width: 35px;
            height: 35px;
        }

        .footer button:first-child {
            margin-top: 0;
        }

        .footer button:nth-child(2) img {
            filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%);
        }

        .footer button:nth-child(2).active img {
            filter: brightness(0) saturate(100%) invert(22%) sepia(99%) saturate(2095%) hue-rotate(154deg) brightness(93%) contrast(101%);
        }

        .footer button.active img {
            filter: brightness(0) saturate(100%) invert(22%) sepia(99%) saturate(2095%) hue-rotate(154deg) brightness(93%) contrast(101%);
        }

        #file-input {
            display: none;
        }

        .delete-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .delete-confirmation-box {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            max-width: 80%;
        }

        .delete-confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .delete-confirmation-btn {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .delete-confirmation-btn.yes {
            background-color: #ff4444;
            color: white;
            border: none;
        }

        .delete-confirmation-btn.no {
            background-color: #00796b;
            color: white;
            border: none;
        }

        .delete-message {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #5c068c;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="lock-screen" id="lockScreen">
        <h2>Enter Passcode</h2>
        <input type="password" class="passcode-input" id="passcodeInput" placeholder="Enter passcode">
        <button class="passcode-submit" onclick="checkPasscode()">Submit</button>
        <div class="passcode-error" id="passcodeError">Incorrect passcode. Please try again.</div>
    </div>

    <div class="update-alert" id="updateAlert">
        <div class="update-alert-content" id="updateAlertContent">
            <h2>🛠 Important Updates</h2>
            <ul>
                <li>Updated Stops: 190, 100, 109X, and 168</li>
                <li>Route 109 is now operational</li>
                <li>Favorites are now fully functional and can be selected/deselected</li>
                <li>Visual feedback for route selection has been improved</li>
                <li>The app now includes sound feedback on some buttons</li>
                <li>New Settings menu added (with toggle and logout)</li>
            </ul>
            <div class="update-alert-checkbox">
                <input type="checkbox" id="dontShowAgain">
                <label for="dontShowAgain">Don't show this message again</label>
            </div>
            <button class="update-alert-button" onclick="acknowledgeUpdate()">Acknowledge</button>
        </div>
    </div>

    <div class="buy-container" id="appContent">
        <div class="header">
            <img src="Exit.png" alt="Exit" class="exit-arrow" onclick="window.history.back()">
            <span>Buy Ticket</span>
        </div>
        
        <div class="search-container">
            <input type="text" id="route-search" placeholder="Search for a route (e.g., 109X, 100)" oninput="filterRoutes()">
        </div>
        
        <div class="stop-selection" id="stop-selection">
            <div class="input-group">
                <label for="origin">Origin</label>
                <input type="text" id="origin" placeholder="Enter origin location" oninput="showSuggestedStops('origin', this.value)" onblur="checkInputComplete('origin')" onkeyup="delayedInputComplete('origin', event)">
                <div class="suggested-stops" id="origin-suggestions"></div>
            </div>
            
            <div class="input-group">
                <label for="destination">Destination</label>
                <input type="text" id="destination" placeholder="Enter destination location" oninput="showSuggestedStops('destination', this.value)" onblur="checkInputComplete('destination')" onkeyup="delayedInputComplete('destination', event)">
                <div class="suggested-stops" id="destination-suggestions"></div>
            </div>
        </div>
        
        <div class="price-display" id="price-display">
            Ticket Price: <span id="price-amount">€0.00</span>
        </div>
        
        <div class="bus-selection">
            <label>Select Bus Route</label>
            <div id="favorites-container" class="favorites-section" style="display: none;">
                <h3>Favorites</h3>
                <div class="bus-options" id="favorite-bus-options"></div>
            </div>
            <div class="bus-options" id="bus-options">
                <div class="bus-option" onclick="selectBus('other')">Other</div>
            </div>
        </div>
        
        <button class="save-btn" onclick="saveJourney()">Confirm Journey</button>
    </div>

    <div class="footer" id="appFooter">
        <button onclick="window.location.href='buy.html'" class="active">
            <img src="EuroSign.png" alt="Euro Icon">
            <span class="nav-label">Buy</span>
        </button>
        <button onclick="window.location.href='index.html'">
            <img src="TicketIcon.png" alt="Ticket Icon">
            <span class="nav-label">Tickets</span>
        </button>
        <button onclick="window.location.href='profile.html'">
            <img src="PersonIcon.png" alt="Profile Icon">
            <span class="nav-label">Profile</span>
        </button>
    </div>

    <script>
        const PASSCODE = "T9C9M10";
        let autoLockTimer;
        const LOCK_TIMEOUT = 3 * 60 * 60 * 1000;
        let currentBus = null;
        let currentFilter = 'all';
        let inputTimeout;
        let originComplete = false;
        let destinationComplete = false;

        // Audio elements
        const purchaseSound = new Audio('purchase.mp3');
        purchaseSound.preload = 'auto';
        const popSound = new Audio('pop.mp3');
        popSound.preload = 'auto';

        function checkPasscode() {
            const input = document.getElementById('passcodeInput').value;
            const errorElement = document.getElementById('passcodeError');
            
            if (input === PASSCODE) {
                const dontShowAgain = localStorage.getItem('dontShowUpdates');
                
                if (dontShowAgain !== 'true') {
                    document.getElementById('updateAlert').style.display = 'flex';
                } else {
                    unlockApp();
                }
            } else {
                errorElement.style.display = 'block';
                document.getElementById('passcodeInput').value = '';
            }
        }

        function unlockApp() {
            document.getElementById('lockScreen').style.display = 'none';
            document.getElementById('appContent').style.display = 'block';
            document.getElementById('appFooter').style.display = 'flex';
            sessionStorage.setItem('authenticated', 'true');
            resetAutoLockTimer();
        }

        function acknowledgeUpdate() {
            const dontShowAgain = document.getElementById('dontShowAgain').checked;
            if (dontShowAgain) {
                localStorage.setItem('dontShowUpdates', 'true');
            }
            
            if (localStorage.getItem('soundEnabled') !== 'false') {
                popSound.play();
            }
            
            document.getElementById('updateAlert').style.display = 'none';
            unlockApp();
        }

        document.getElementById('updateAlert').addEventListener('click', function(e) {
            if (e.target === this) {
                const content = document.getElementById('updateAlertContent');
                content.classList.add('shake');
                setTimeout(() => {
                    content.classList.remove('shake');
                }, 500);
            }
        });

        function resetAutoLockTimer() {
            if (autoLockTimer) {
                clearTimeout(autoLockTimer);
            }
            autoLockTimer = setTimeout(lockApp, LOCK_TIMEOUT);
        }

        function lockApp() {
            document.getElementById('lockScreen').style.display = 'flex';
            document.getElementById('appContent').style.display = 'none';
            document.getElementById('appFooter').style.display = 'none';
            document.getElementById('passcodeInput').value = '';
            document.getElementById('passcodeError').style.display = 'none';
            sessionStorage.removeItem('authenticated');
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                document.getElementById('appFooter').style.display = 'flex';
                resetAutoLockTimer();
            } else {
                document.getElementById('lockScreen').style.display = 'flex';
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('appFooter').style.display = 'none';
            }

            document.addEventListener('click', resetAutoLockTimer);
            document.addEventListener('keypress', resetAutoLockTimer);
            document.addEventListener('scroll', resetAutoLockTimer);
            document.addEventListener('mousemove', resetAutoLockTimer);

            const savedOrigin = localStorage.getItem('ticketOrigin');
            const savedDestination = localStorage.getItem('ticketDestination');
            
            if (savedOrigin) {
                document.getElementById('origin').value = savedOrigin;
                document.querySelector('#origin').parentElement.classList.add('input-focused');
            }
            if (savedDestination) {
                document.getElementById('destination').value = savedDestination;
                document.querySelector('#destination').parentElement.classList.add('input-focused');
            }

            setActiveNavigation();
            populateBusOptions();
        });

        function setActiveNavigation() {
            const currentPage = window.location.pathname.split('/').pop();
            const navButtons = document.querySelectorAll('.footer button');
            
            navButtons.forEach(button => {
                button.classList.remove('active');
                const buttonPage = button.querySelector('.nav-label').textContent.toLowerCase();
                if (buttonPage === 'buy' && currentPage === 'buy.html') {
                    button.classList.add('active');
                }
            });
        }

        const PRIORITY_ROUTES = ['100', '109', '109A', '109X', '115', 'NX'];
        
        const busRoutes = {
            "100": ["Dundalk Bus Station", "Stapleton Place", "Louth Hospital", "Dundalk It", "Seafield Road", "Greengates", "Castlebellingham", "Saint Oliver's Park", "Saint Mary's Villas", "Mullins Cross", "Dunleer", "Mullary", "Tinure", "Naomh Mairtin Gfc", "Cockle Road Cross", "Tullyeskar", "Drogheda Hospital", "Drogheda Bus Station"],
            "100X": ["Dublin Busáras", "Dublin Airport", "Drogheda", "Dundalk Bus Station"],
            "101": ["Dublin Busáras", "Dublin Airport", "Swords", "Balbriggan", "Drogheda Bus Station"],
            "101X": ["Dublin Busáras", "Dublin Airport", "Drogheda Bus Station"],
            "103": ["Dublin Busáras", "Blanchardstown SC", "Dunboyne", "Ratoath"],
            "103X": ["Dublin Busáras", "Blanchardstown SC", "Navan Bus Station"],
            "105": ["Blanchardstown SC", "Ashbourne", "Drogheda Bus Station"],
            "105X": ["Dublin Busáras", "Liffey Valley SC", "Fairyhouse Cross"],
            "107": ["Navan Bus Station", "Kingscourt"],
            "108": ["Kells Bus Station", "Bailieboro"],
            "109": ["Kells Ind Estate", "Father Mccullen Park", "Kells", "Kilmainham", "Bloomsbury Cross", "Tankardstown", "Mitchells Cross", "Kells Road", "Blackwater Retail Park", "Navan", "Abbey Road", "Ardboyne Hotel", "Kilcarn Bridge", "St Columbans", "Garlow Cross", "Tara Cross", "Lismullen", "Old Ross Road", "Grange Hall", "Dunshaughlin", "Dunshaughlin Ie", "The Willows", "Ballymurphy", "Bush Lane", "Rathbeggan", "Porterstown Lane", "Fairyhouse Cross", "Msd Dunboyne", "Bracetown Park", "The Fairways Apartments", "N3 Slip Road", "Parkway Station", "Navan Road", "Phibsborough Po", "Mater Hospital, Berkeley Road", "O'Connell Street Upper", "Irish Life Mall", "Westland Row Church", "Merrion Square, Holles Street", "Wilton Terrace"],
            "109A": ["Busáras", "Tower View", "Abbey Road", "Johnstown Centre", "Boyne View", "St Columbans", "Garlow Cross", "Dunshaughlin", "Steeplechase Hill", "Holy Trinity Church", "Ballybin Roundabout", "Ashbourne Centre", "Ballybin Road", "Saint John's Wood Court", "Ashbourne Credit Union", "Ashbourne", "Bourne Avenue", "Ashbourne Community College", "Hickey's Lane", "Ratoath", "Dublin Airport", "Ninemile Stone", "DCU Collins Avenue"],
            "109B": ["Dublin Busáras", "Trim"],
            "109X": ["Dublin Busáras", "Innisfallen Parade", "Binns Bridge", "Finglas Road", "Wellmount Road", "St Margaret's Road", "Blanchardstown Shopping Centre", "Springfield Glen", "Kells Road", "Kells", "Cavan Road", "Father Mccullen Pk", "Kells Business Park", "St Ciaran's Church", "Carnaross North", "Whitegate Cross", "Maghera Cross Roads", "Lough Ramor", "Virginia", "Lisgrea", "Billis", "New Inn", "Knocknagillagh", "Lavey", "Kilmore Hotel", "Training Campus", "Crystal Hotel", "Breffni Retail Park", "Cavan Bus Station"],
            "111": ["Dublin Busáras", "Athboy"],
            "111A": ["Cavan Bus Station", "Delvin"],
            "111X": ["Dublin Busáras", "Clonmellon"],
            "115": ["Dublin Busáras", "Mullingar Bus Station"],
            "115C": ["Kilcock", "Mullingar Bus Station"],
            "131": ["Bray DART Station", "Wicklow Town"],
            "132": ["Dublin Busáras", "Bunclody"],
            "133": ["Dublin Busáras", "Wicklow Town"],
            "160": ["Dundalk Bus Station", "Newry Bus Station"],
            "161": ["Dundalk Bus Station", "Newry Bus Station"],
            "162": ["Monaghan Bus Station", "Dundalk Bus Station"],
            "167": ["Dundalk Bus Station", "Mullingar Bus Station"],
            "168": ["Dundalk Bus Station", "Stapleton Place", "Louth Hospital", "Dundalk It", "Seafield Road", "Greengates", "Carrolls Cross", "Dromiskin Cross", "Dromiskin", "Castlebellingham", "Annagassan", "Grangebellew", "Hackets Cross", "Clogher Village", "Termonfeckin", "Baltray", "Saint Joseph's Secondary School", "Scarlet Street", "St Joseph's Cbs", "Bóthar Brugha", "Drogheda Hospital", "Drogheda Bus Station"],
            "170": ["Cavan Bus Station", "Dundalk Bus Station"],
            "175": ["Monaghan Bus Station", "Cavan Bus Station"],
            "175A": ["Cavan Bus Station", "Monaghan Bus Station"],
            "182": ["Drogheda Bus Station", "Monaghan Bus Station"],
            "187": ["Kells Bus Station", "Virginia"],
            "190": ["Drogheda Bus Station", "Georges Street", "Bóthar Brugha", "Drogheda Hospital", "M1 Retail Park", "Slane", "Navan", "Railway Street", "Beaufort College", "Connells Cross", "Trim Retail Park", "Trim Castle", "Ballivor Church", "Raharney", "Killucan", "Ardmore Road", "Petitswood", "Prospect", "Castle Street", "Moate", "Tus East Campus", "Athlone Station"],
            "226": ["Kinsale", "Cork Kent Station"],
            "226X": ["Kinsale", "MTU"],
            "233": ["Cork Bus Station", "Macroom"],
            "235": ["Cork Bus Station", "Rylane"],
            "236": ["Cork Bus Station", "Glengarriff"],
            "237": ["Cork Bus Station", "Goleen"],
            "239": ["Cork Bus Station", "Butlerstown"],
            "240": ["Cork Bus Station", "Ballycotton"],
            "241": ["Cork Bus Station", "Trabolgan"],
            "243": ["Cork Bus Station", "Doneraile"],
            "245": ["Cork Bus Station", "Clonmel"],
            "245X": ["Dublin Busáras", "Cork Bus Station"],
            "257": ["Macroom", "Killarney"],
            "258": ["Macroom", "Rylane"],
            "259": ["Macroom", "Renaniree"],
            "260": ["Cork Bus Station", "Ardmore"],
            "261": ["Cork Bus Station", "Ballinacurra"],
            "270": ["Skibbereen", "Killarney"],
            "271": ["Tralee", "Killarney"],
            "272": ["Tralee", "Ballybunion"],
            "275": ["Tralee", "Dingle"],
            "279": ["Tralee", "Killorglin"],
            "279A": ["Killarney", "Waterville"],
            "284": ["Tralee", "Killarney"],
            "314": ["Limerick Bus Station", "Ballybunion"],
            "316": ["Shannon Airport", "Sixmilebridge"],
            "317": ["Limerick Bus Station", "Ennis"],
            "317A": ["Limerick Bus Station", "Ennis"],
            "320": ["Limerick Bus Station", "Charleville"],
            "321": ["Limerick Bus Station", "Newcastle West"],
            "323": ["Limerick Bus Station", "Nenagh"],
            "323X": ["Limerick Bus Station", "Birr"],
            "328": ["Limerick Bus Station", "Mitchelstown"],
            "329": ["Limerick Bus Station", "Kilfinane"],
            "330": ["Ennis", "Shannon Airport"],
            "330X": ["Limerick Bus Station", "Ennis"],
            "332": ["Limerick Bus Station", "Cashel"],
            "333": ["Ennis", "Kilkee"],
            "336": ["Ennis", "Doonbeg"],
            "343": ["Limerick Bus Station", "Shannon"],
            "345": ["Limerick Bus Station", "Scariff"],
            "347": ["Limerick Bus Station", "Tipperary"],
            "350": ["Galway Bus Station", "Ennis"],
            "354": ["Carrick-On-Suir", "Dunmore East"],
            "355": ["Waterford Bus Station", "Cahir"],
            "362": ["Waterford Bus Station", "Dungarvan"],
            "365": ["Waterford Bus Station", "Thomastown"],
            "366": ["Lismore", "Waterford Bus Station"],
            "370": ["Waterford Bus Station", "Rosslare"],
            "371": ["New Ross", "Wexford"],
            "372": ["New Ross", "Wexford"],
            "373": ["New Ross", "Wexford"],
            "374": ["New Ross", "Kilkenny"],
            "375": ["New Ross", "Enniscorthy"],
            "377": ["Wexford", "Enniscorthy"],
            "378": ["Wexford", "Churchtown"],
            "379": ["Wexford", "Gorey"],
            "380": ["Wexford", "Crossabeg"],
            "381": ["Wexford", "Blackhall"],
            "382": ["Wexford", "Adamstown"],
            "383": ["Wexford", "Additional Stop"],
            "385": ["Wexford", "Rosslare Europort"],
            "417": ["Galway Bus Station", "Ballinastack"],
            "419": ["Galway Bus Station", "Clifden"],
            "420": ["Ballina Bus Station", "Castlebar Bus Station"],
            "421": ["Swinford", "Claremorris"],
            "422": ["Castlebar Bus Station", "Headford"],
            "423": ["Clifden", "Westport"],
            "424": ["Galway Bus Station", "Lettermullen"],
            "425": ["Galway Bus Station", "Longford"],
            "425A": ["Galway Bus Station", "Mountbellew"],
            "429": ["Galway Bus Station", "Castlerea"],
            "434": ["Galway Bus Station", "Gort"],
            "440": ["Athlone Bus Station", "Westport"],
            "442": ["Charlestown", "Roundfort"],
            "444": ["Ballina Bus Station", "Dromore West"],
            "445": ["Ballina Bus Station", "Ballycastle"],
            "446": ["Ballina Bus Station", "Blacksod"],
            "447": ["Finea", "Mullingar"],
            "448": ["Shandonagh", "Mullingar"],
            "450": ["Dooagh", "Louisburgh"],
            "451": ["Ballina Bus Station", "Longford"],
            "455": ["Ballina Bus Station", "Crossmolina"],
            "456": ["Galway Bus Station", "Castlebar"],
            "457": ["Castlerea", "Roscommon"],
            "458": ["Ballina Bus Station", "Enniskillen"],
            "461": ["Athlone Bus Station", "Roscommon"],
            "462": ["Sligo Bus Station", "Carrigallen"],
            "463": ["Carrigallen", "Longford"],
            "464": ["Carrigallen", "Enniskillen"],
            "465": ["Carrigallen", "Cavan"],
            "466": ["Athlone Bus Station", "Cavan"],
            "467": ["Longford", "Lanesborough"],
            "470": ["Sligo Bus Station", "Glenfarne"],
            "471": ["Sligo Bus Station", "Riverstown"],
            "480": ["Sligo Bus Station", "Derry"],
            "483": ["Ballyshannon", "Sligo Bus Station"],
            "487": ["Strabane", "Letterkenny"],
            "489": ["Letterkenny", "Strabane"],
            "490": ["Donegal", "Glencolumbcille"],
            "491": ["Letterkenny", "Ballybofey"],
            "492": ["Donegal", "Dungloe"],
            "494": ["Strabane", "Ballybofey"],
            "65": ["Galway Bus Station", "Cavan"],
            "70": ["Athlone Bus Station", "Navan"],
            "72": ["Limerick Bus Station", "Athlone"],
            "73": ["Waterford Bus Station", "Athlone"],
            "NX": ["Abbey Road", "Ratholdren Road", "Leisure Link", "Russell Court", "Navan Park And Ride", "Navan", "Limekilnhill", "Meath County Council", "Johnstown Centre", "Boyne View", "St Columbans", "Garlow Cross", "Blanchardstown", "N3 Slip Road", "North Circular Road", "Broadstone", "O'Connell Street Upper", "Irish Life Mall", "Westland Row Church", "Merrion Square, Holles Street", "Wilton Terrace"]
        };

        const ticketPrices = {
            "100": { "shortFare": 1.82, "standardFare": 2.80 },
            "100X": { "shortFare": 1.82, "standardFare": 2.80 },
            "101": { "shortFare": 1.82, "standardFare": 2.80 },
            "101X": { "shortFare": 1.82, "standardFare": 2.80 },
            "103": { "shortFare": 1.82, "standardFare": 2.80 },
            "103X": { "shortFare": 1.82, "standardFare": 2.80 },
            "105": { "shortFare": 1.82, "standardFare": 2.80 },
            "105X": { "shortFare": 1.82, "standardFare": 2.80 },
            "107": { "shortFare": 1.82, "standardFare": 2.80 },
            "108": { "shortFare": 1.82, "standardFare": 2.80 },
            "109": { "shortFare": 1.82, "standardFare": 2.80 },
            "109A": { "shortFare": 1.82, "standardFare": 2.80 },
            "109B": { "shortFare": 1.82, "standardFare": 2.80 },
            "109X": { "shortFare": 1.82, "standardFare": 2.80 },
            "111": { "shortFare": 1.82, "standardFare": 2.80 },
            "111A": { "shortFare": 1.82, "standardFare": 2.80 },
            "111X": { "shortFare": 1.82, "standardFare": 2.80 },
            "115": { "shortFare": 1.82, "standardFare": 2.80 },
            "115C": { "shortFare": 1.82, "standardFare": 2.80 },
            "131": { "shortFare": 1.82, "standardFare": 2.80 },
            "132": { "shortFare": 1.82, "standardFare": 2.80 },
            "133": { "shortFare": 1.82, "standardFare": 2.80 },
            "160": { "shortFare": 1.82, "standardFare": 2.80 },
            "161": { "shortFare": 1.82, "standardFare": 2.80 },
            "162": { "shortFare": 1.82, "standardFare": 2.80 },
            "167": { "shortFare": 1.82, "standardFare": 2.80 },
            "168": { "shortFare": 1.82, "standardFare": 2.80 },
            "170": { "shortFare": 1.82, "standardFare": 2.80 },
            "175": { "shortFare": 1.82, "standardFare": 2.80 },
            "175A": { "shortFare": 1.82, "standardFare": 2.80 },
            "182": { "shortFare": 1.82, "standardFare": 2.80 },
            "187": { "shortFare": 1.82, "standardFare": 2.80 },
            "190": { "shortFare": 1.82, "standardFare": 2.80 },
            "226": { "shortFare": 1.82, "standardFare": 2.80 },
            "226X": { "shortFare": 1.82, "standardFare": 2.80 },
            "233": { "shortFare": 1.82, "standardFare": 2.80 },
            "235": { "shortFare": 1.82, "standardFare": 2.80 },
            "236": { "shortFare": 1.82, "standardFare": 2.80 },
            "237": { "shortFare": 1.82, "standardFare": 2.80 },
            "239": { "shortFare": 1.82, "standardFare": 2.80 },
            "240": { "shortFare": 1.82, "standardFare": 2.80 },
            "241": { "shortFare": 1.82, "standardFare": 2.80 },
            "243": { "shortFare": 1.82, "standardFare": 2.80 },
            "245": { "shortFare": 1.82, "standardFare": 2.80 },
            "245X": { "shortFare": 1.82, "standardFare": 2.80 },
            "257": { "shortFare": 1.82, "standardFare": 2.80 },
            "258": { "shortFare": 1.82, "standardFare": 2.80 },
            "259": { "shortFare": 1.82, "standardFare": 2.80 },
            "260": { "shortFare": 1.82, "standardFare": 2.80 },
            "261": { "shortFare": 1.82, "standardFare": 2.80 },
            "270": { "shortFare": 1.82, "standardFare": 2.80 },
            "271": { "shortFare": 1.82, "standardFare": 2.80 },
            "272": { "shortFare": 1.82, "standardFare": 2.80 },
            "275": { "shortFare": 1.82, "standardFare": 2.80 },
            "279": { "shortFare": 1.82, "standardFare": 2.80 },
            "279A": { "shortFare": 1.82, "standardFare": 2.80 },
            "284": { "shortFare": 1.82, "standardFare": 2.80 },
            "314": { "shortFare": 1.82, "standardFare": 2.80 },
            "316": { "shortFare": 1.82, "standardFare": 2.80 },
            "317": { "shortFare": 1.82, "standardFare": 2.80 },
            "317A": { "shortFare": 1.82, "standardFare": 2.80 },
            "320": { "shortFare": 1.82, "standardFare": 2.80 },
            "321": { "shortFare": 1.82, "standardFare": 2.80 },
            "323": { "shortFare": 1.82, "standardFare": 2.80 },
            "323X": { "shortFare": 1.82, "standardFare": 2.80 },
            "328": { "shortFare": 1.82, "standardFare": 2.80 },
            "329": { "shortFare": 1.82, "standardFare": 2.80 },
            "330": { "shortFare": 1.82, "standardFare": 2.80 },
            "330X": { "shortFare": 1.82, "standardFare": 2.80 },
            "332": { "shortFare": 1.82, "standardFare": 2.80 },
            "333": { "shortFare": 1.82, "standardFare": 2.80 },
            "336": { "shortFare": 1.82, "standardFare": 2.80 },
            "343": { "shortFare": 1.82, "standardFare": 2.80 },
            "345": { "shortFare": 1.82, "standardFare": 2.80 },
            "347": { "shortFare": 1.82, "standardFare": 2.80 },
            "350": { "shortFare": 1.82, "standardFare": 2.80 },
            "354": { "shortFare": 1.82, "standardFare": 2.80 },
            "355": { "shortFare": 1.82, "standardFare": 2.80 },
            "362": { "shortFare": 1.82, "standardFare": 2.80 },
            "365": { "shortFare": 1.82, "standardFare": 2.80 },
            "366": { "shortFare": 1.82, "standardFare": 2.80 },
            "370": { "shortFare": 1.82, "standardFare": 2.80 },
            "371": { "shortFare": 1.82, "standardFare": 2.80 },
            "372": { "shortFare": 1.82, "standardFare": 2.80 },
            "373": { "shortFare": 1.82, "standardFare": 2.80 },
            "374": { "shortFare": 1.82, "standardFare": 2.80 },
            "375": { "shortFare": 1.82, "standardFare": 2.80 },
            "377": { "shortFare": 1.82, "standardFare": 2.80 },
            "378": { "shortFare": 1.82, "standardFare": 2.80 },
            "379": { "shortFare": 1.82, "standardFare": 2.80 },
            "380": { "shortFare": 1.82, "standardFare": 2.80 },
            "381": { "shortFare": 1.82, "standardFare": 2.80 },
            "382": { "shortFare": 1.82, "standardFare": 2.80 },
            "383": { "shortFare": 1.82, "standardFare": 2.80 },
            "385": { "shortFare": 1.82, "standardFare": 2.80 },
            "417": { "shortFare": 1.82, "standardFare": 2.80 },
            "419": { "shortFare": 1.82, "standardFare": 2.80 },
            "420": { "shortFare": 1.82, "standardFare": 2.80 },
            "421": { "shortFare": 1.82, "standardFare": 2.80 },
            "422": { "shortFare": 1.82, "standardFare": 2.80 },
            "423": { "shortFare": 1.82, "standardFare": 2.80 },
            "424": { "shortFare": 1.82, "standardFare": 2.80 },
            "425": { "shortFare": 1.82, "standardFare": 2.80 },
            "425A": { "shortFare": 1.82, "standardFare": 2.80 },
            "429": { "shortFare": 1.82, "standardFare": 2.80 },
            "434": { "shortFare": 1.82, "standardFare": 2.80 },
            "440": { "shortFare": 1.82, "standardFare": 2.80 },
            "442": { "shortFare": 1.82, "standardFare": 2.80 },
            "444": { "shortFare": 1.82, "standardFare": 2.80 },
            "445": { "shortFare": 1.82, "standardFare": 2.80 },
            "446": { "shortFare": 1.82, "standardFare": 2.80 },
            "447": { "shortFare": 1.82, "standardFare": 2.80 },
            "448": { "shortFare": 1.82, "standardFare": 2.80 },
            "450": { "shortFare": 1.82, "standardFare": 2.80 },
            "451": { "shortFare": 1.82, "standardFare": 2.80 },
            "455": { "shortFare": 1.82, "standardFare": 2.80 },
            "456": { "shortFare": 1.82, "standardFare": 2.80 },
            "457": { "shortFare": 1.82, "standardFare": 2.80 },
            "458": { "shortFare": 1.82, "standardFare": 2.80 },
            "461": { "shortFare": 1.82, "standardFare": 2.80 },
            "462": { "shortFare": 1.82, "standardFare": 2.80 },
            "463": { "shortFare": 1.82, "standardFare": 2.80 },
            "464": { "shortFare": 1.82, "standardFare": 2.80 },
            "465": { "shortFare": 1.82, "standardFare": 2.80 },
            "466": { "shortFare": 1.82, "standardFare": 2.80 },
            "467": { "shortFare": 1.82, "standardFare": 2.80 },
            "470": { "shortFare": 1.82, "standardFare": 2.80 },
            "471": { "shortFare": 1.82, "standardFare": 2.80 },
            "480": { "shortFare": 1.82, "standardFare": 2.80 },
            "483": { "shortFare": 1.82, "standardFare": 2.80 },
            "487": { "shortFare": 1.82, "standardFare": 2.80 },
            "489": { "shortFare": 1.82, "standardFare": 2.80 },
            "490": { "shortFare": 1.82, "standardFare": 2.80 },
            "491": { "shortFare": 1.82, "standardFare": 2.80 },
            "492": { "shortFare": 1.82, "standardFare": 2.80 },
            "494": { "shortFare": 1.82, "standardFare": 2.80 },
            "65": { "shortFare": 1.82, "standardFare": 2.80 },
            "70": { "shortFare": 1.82, "standardFare": 2.80 },
            "72": { "shortFare": 1.82, "standardFare": 2.80 },
            "73": { "shortFare": 1.82, "standardFare": 2.80 },
            "NX": { "shortFare": 1.82, "standardFare": 2.80 },
            "other": { "defaultFare": 2.17 }
        };

        let favorites = JSON.parse(localStorage.getItem('busFavorites')) || {
            buses: [],
            stops: []
        };

        let journeyHistory = JSON.parse(localStorage.getItem('journeyHistory')) || [];

        function populateBusOptions(filter = '') {
            const busOptionsContainer = document.getElementById('bus-options');
            const favoritesContainer = document.getElementById('favorites-container');
            const favoriteBusOptions = document.getElementById('favorite-bus-options');
            
            busOptionsContainer.innerHTML = '<div class="bus-option" onclick="selectBus(\'other\')">Other</div>';
            
            favoriteBusOptions.innerHTML = '';
            
            const hasFavorites = favorites.buses.length > 0;
            favoritesContainer.style.display = hasFavorites ? 'block' : 'none';
            
            PRIORITY_ROUTES.forEach(busNumber => {
                if (filter && !busNumber.toLowerCase().includes(filter.toLowerCase())) {
                    return;
                }
                
                const isFavorite = favorites.buses.includes(busNumber);
                const busOption = createBusOption(busNumber, isFavorite);
                
                if (isFavorite) {
                    favoriteBusOptions.appendChild(busOption);
                } else {
                    busOptionsContainer.appendChild(busOption);
                }
            });
            
            Object.keys(busRoutes).forEach(busNumber => {
                if (PRIORITY_ROUTES.includes(busNumber)) return;
                
                if (filter && !busNumber.toLowerCase().includes(filter.toLowerCase())) {
                    return;
                }
                
                const isFavorite = favorites.buses.includes(busNumber);
                const busOption = createBusOption(busNumber, isFavorite);
                
                if (isFavorite) {
                    favoriteBusOptions.appendChild(busOption);
                } else {
                    busOptionsContainer.appendChild(busOption);
                }
            });
        }

        function createBusOption(busNumber, isFavorite) {
            const busOption = document.createElement('div');
            busOption.className = `bus-option ${isFavorite ? 'favorite' : ''}`;
            busOption.setAttribute('data-bus-number', busNumber);
            busOption.innerHTML = `
                ${busNumber}
                <span class="star" onclick="toggleBusFavorite(event, '${busNumber}')">
                    ${isFavorite ? '★' : '☆' }
                </span>
            `;
            busOption.onclick = function() {
                selectBus(busNumber);
            };
            return busOption;
        }

        function filterRoutes() {
            const searchTerm = document.getElementById('route-search').value;
            populateBusOptions(searchTerm);
        }

        function selectBus(busNumber) {
            document.querySelectorAll('.bus-option').forEach(option => {
                option.classList.remove('selected');
                option.style.backgroundColor = '';
                option.style.color = '';
                
                if (option.classList.contains('favorite')) {
                    option.style.border = '2px solid #5c068c';
                }
            });
            
            if (currentBus === busNumber) {
                currentBus = null;
                document.querySelectorAll('.bus-option').forEach(option => {
                    option.classList.remove('hidden');
                });
                return;
            }
            
            currentBus = busNumber;
            
            document.querySelectorAll('.bus-option').forEach(option => {
                if (option.getAttribute('data-bus-number') !== busNumber) {
                    option.classList.add('hidden');
                }
            });
            
            const selectedOption = document.querySelector(`.bus-option[data-bus-number="${busNumber}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                if (selectedOption.classList.contains('favorite')) {
                    selectedOption.style.backgroundColor = '#5c068c';
                } else {
                    selectedOption.style.backgroundColor = '#00796b';
                }
                selectedOption.style.color = 'white';
            }
            
            document.getElementById('origin-suggestions').innerHTML = '';
            document.getElementById('destination-suggestions').innerHTML = '';
            
            if (busNumber === 'other') {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€2.17';
            } else {
                document.getElementById('price-display').style.display = 'none';
            }
        }

        function showSuggestedStops(type, query) {
            if (!currentBus || currentBus === 'other') return;
            
            const suggestionsContainer = document.getElementById(`${type}-suggestions`);
            suggestionsContainer.innerHTML = '';
            
            if (!query) return;
            
            const filteredStops = busRoutes[currentBus].filter(stop => 
                stop.toLowerCase().includes(query.toLowerCase())
            );
            
            filteredStops.forEach(stop => {
                const isFavorite = favorites.stops.includes(stop);
                const stopItem = document.createElement('div');
                stopItem.className = 'stop-item';
                stopItem.innerHTML = `
                    ${stop}
                    <span class="star ${isFavorite ? 'favorite' : ''}" 
                          onclick="toggleStopFavorite(event, '${stop}')">
                        ${isFavorite ? '★' : '☆' }
                    </span>
                `;
                stopItem.onclick = function() {
                    document.getElementById(type).value = stop;
                    suggestionsContainer.innerHTML = '';
                    calculatePrice();
                    checkInputComplete(type);
                };
                suggestionsContainer.appendChild(stopItem);
            });
        }

        function calculatePrice() {
            if (!currentBus || currentBus === 'other') {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€2.17';
                return;
            }
            
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            
            if (!origin || !destination) return;
            
            const distance = calculateDistance(origin, destination, currentBus);
            if (distance === null) {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€2.17';
                return;
            }
            
            const isShortFare = distance <= 3;
            const price = isShortFare ? ticketPrices[currentBus].shortFare : ticketPrices[currentBus].standardFare;
            
            document.getElementById('price-amount').textContent = `€${price.toFixed(2)}`;
            document.getElementById('price-display').style.display = 'block';
        }

        function calculateDistance(origin, destination, busNumber) {
            const stops = busRoutes[busNumber];
            const originIndex = stops.indexOf(origin);
            const destinationIndex = stops.indexOf(destination);
            
            if (originIndex === -1 || destinationIndex === -1) return null;
            
            return Math.abs(destinationIndex - originIndex);
        }

        function toggleBusFavorite(event, busNumber) {
            event.stopPropagation();
            const index = favorites.buses.indexOf(busNumber);
            
            if (index === -1) {
                favorites.buses.push(busNumber);
            } else {
                favorites.buses.splice(index, 1);
            }
            
            localStorage.setItem('busFavorites', JSON.stringify(favorites));
            
            const starElement = event.target;
            starElement.textContent = index === -1 ? '★' : '☆';
            starElement.parentElement.classList.toggle('favorite');
            
            populateBusOptions(document.getElementById('route-search').value);
        }

        function toggleStopFavorite(event, stop) {
            event.stopPropagation();
            const index = favorites.stops.indexOf(stop);
            
            if (index === -1) {
                favorites.stops.push(stop);
            } else {
                favorites.stops.splice(index, 1);
            }
            
            localStorage.setItem('busFavorites', JSON.stringify(favorites));
            
            event.target.classList.toggle('favorite');
            event.target.textContent = index === -1 ? '★' : '☆';
        }

        function checkInputComplete(inputType) {
            const input = document.getElementById(inputType);
            const container = input.parentElement;
            
            if (input.value.trim()) {
                container.classList.add('input-focused');
                
                if (isCompleteInput(input.value)) {
                    container.classList.add('input-complete');
                    if (inputType === 'origin') {
                        originComplete = true;
                    } else {
                        destinationComplete = true;
                    }
                }
            } else {
                container.classList.remove('input-focused');
                container.classList.remove('input-complete');
                if (inputType === 'origin') {
                    originComplete = false;
                } else {
                    destinationComplete = false;
                }
            }
        }

        function isCompleteInput(value) {
            return value.trim().length > 3 && value.includes(' ');
        }

        function delayedInputComplete(inputType, event) {
            clearTimeout(inputTimeout);
            inputTimeout = setTimeout(() => {
                checkInputComplete(inputType);
            }, 3000);
        }

        function saveJourney() {
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const price = document.getElementById('price-amount').textContent;
            
            if (!currentBus || !origin || !destination) {
                alert('Please select a bus and both origin and destination');
                return;
            }
            
            // Play purchase sound if enabled
            if (localStorage.getItem('soundEnabled') !== 'false') {
                purchaseSound.play();
            }
            
            localStorage.setItem('ticketOrigin', origin);
            localStorage.setItem('ticketDestination', destination);
            
            const journey = {
                bus: currentBus,
                origin: origin,
                destination: destination,
                price: price,
                date: new Date().toISOString(),
                completed: false
            };
            
            journeyHistory.unshift(journey);
            localStorage.setItem('journeyHistory', JSON.stringify(journeyHistory));
            
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
