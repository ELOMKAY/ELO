<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFI Go - Buy Ticket</title>
    <style>
        /* Lock Screen Styles */
        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #00796b;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .lock-screen h2 {
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .passcode-input {
            padding: 10px;
            font-size: 18px;
            margin-bottom: 20px;
            width: 200px;
            text-align: center;
            border: none;
            border-radius: 4px;
        }
        
        .passcode-submit {
            padding: 10px 20px;
            background-color: #5c068c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .passcode-error {
            color: #ffcccc;
            margin-top: 10px;
            display: none;
        }

        /* Main App Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .buy-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            text-align: center;
            padding-bottom: 80px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            position: relative;
            display: none;
        }

        .header {
            background-color: #00796b;
            color: white;
            padding: 20px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header span {
            flex: 1;
            text-align: center;
        }

        .exit-arrow {
            width: 20px;
            height: 20px;
            position: absolute;
            left: 20px;
            filter: brightness(0) invert(1);
            cursor: pointer;
        }

        .search-container {
            margin: 20px auto;
            width: 90%;
            max-width: 500px;
        }

        .search-container input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .stop-selection {
            margin: 20px auto;
            width: 90%;
            max-width: 500px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 18px;
            color: #00453c;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .input-group::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #5c068c;
            transition: width 0.5s ease;
        }

        .input-group.filled::after {
            width: 100%;
        }

        .suggested-stops {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }

        .stop-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stop-item:hover {
            background-color: #f5f5f5;
        }

        .stop-item .star {
            color: #ccc;
            cursor: pointer;
        }

        .stop-item .star.favorite {
            color: #5c068c;
        }

        .bus-selection {
            margin: 20px auto;
            width: 90%;
            max-width: 500px;
            text-align: left;
        }

        .bus-selection label {
            display: block;
            margin-bottom: 8px;
            font-size: 18px;
            color: #00453c;
            font-weight: bold;
        }

        .bus-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .bus-option {
            background-color: #f0f0f0;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bus-option.selected {
            background-color: #5c068c;
            color: white;
        }

        .bus-option.favorite {
            border: 2px solid #5c068c;
        }

        .bus-option.hidden {
            display: none;
        }

        .favorites-section {
            margin-bottom: 20px;
            border-bottom: 2px solid #5c068c;
            padding-bottom: 10px;
        }

        .favorites-section h3 {
            color: #5c068c;
            margin-bottom: 10px;
        }

        .price-display {
            font-size: 18px;
            margin: 20px 0;
            color: #5c068c;
            font-weight: bold;
            display: none;
        }

        .save-btn {
            background-color: #5c068c;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }

        .save-btn:hover {
            background-color: #4a056e;
        }

        .footer {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            border-top: 1px solid #ddd;
            background-color: white;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: none;
        }

        .footer button {
            background: none;
            border: none;
            font-size: 16px;
            color: #585858;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .footer button.active {
            color: #007C60;
        }

        .footer button img {
            width: 40px;
            height: 40px;
            margin-bottom: 5px;
            border-radius: 50%;
            object-fit: cover;
        }

        .footer button:first-child img {
            width: 48px;
            height: 48px;
            filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%);
        }

        .footer button:first-child.active img {
            filter: brightness(0) saturate(100%) invert(28%) sepia(99%) saturate(1066%) hue-rotate(142deg) brightness(96%) contrast(101%);
        }

        .footer button:first-child {
            margin-top: -4px;
        }

        .footer button:nth-child(2) img {
            filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%);
        }

        .footer button:nth-child(2).active img {
            filter: brightness(0) saturate(100%) invert(22%) sepia(99%) saturate(2095%) hue-rotate(154deg) brightness(93%) contrast(101%);
        }

        .footer button:nth-child(3) img {
            filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%);
        }

        .confirmation-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #5c068c;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Lock Screen -->
    <div class="lock-screen" id="lockScreen">
        <h2>Enter Passcode</h2>
        <input type="password" class="passcode-input" id="passcodeInput" placeholder="Enter passcode">
        <button class="passcode-submit" onclick="checkPasscode()">Submit</button>
        <div class="passcode-error" id="passcodeError">Incorrect passcode. Please try again.</div>
    </div>

    <!-- Main App Content -->
    <div class="buy-container" id="appContent">
        <div class="header">
            <img src="Exit.png" alt="Exit" class="exit-arrow" onclick="window.history.back()">
            <span>Buy Ticket</span>
        </div>
        
        <div class="search-container">
            <input type="text" id="route-search" placeholder="Search for a route (e.g., 109X, 100)" oninput="filterRoutes()">
        </div>
        
        <div class="stop-selection" id="stop-selection">
            <div class="input-group" id="origin-group">
                <label for="origin">Origin</label>
                <input type="text" id="origin" placeholder="Enter origin location" 
                       oninput="showSuggestedStops('origin', this.value)"
                       onblur="checkInputFilled('origin')">
                <div class="suggested-stops" id="origin-suggestions"></div>
            </div>
            
            <div class="input-group" id="destination-group">
                <label for="destination">Destination</label>
                <input type="text" id="destination" placeholder="Enter destination location" 
                       oninput="showSuggestedStops('destination', this.value)"
                       onblur="checkInputFilled('destination')">
                <div class="suggested-stops" id="destination-suggestions"></div>
            </div>
            
            <div class="price-display" id="price-display">
                Ticket Price: <span id="price-amount">€0.00</span>
            </div>
        </div>
        
        <div class="bus-selection">
            <label>Select Bus Route</label>
            <div id="favorites-container" class="favorites-section" style="display: none;">
                <h3>Favorites</h3>
                <div class="bus-options" id="favorite-bus-options"></div>
            </div>
            <div class="bus-options" id="bus-options">
                <div class="bus-option" onclick="selectBus('other')">Other</div>
            </div>
        </div>
        
        <button class="save-btn" onclick="saveJourney()">Confirm Journey</button>
    </div>

    <div class="footer" id="appFooter">
        <button class="active" onclick="window.location.href='buy.html'">
            <img src="EuroSign.png" alt="Euro Icon">
            Buy
        </button>
        <button onclick="window.location.href='index.html'">
            <img src="TicketIcon.png" alt="Ticket Icon">
            Tickets
        </button>
        <button onclick="window.location.href='profile.html'">
            <img src="PersonIcon.png" alt="Profile Icon">
            Profile
        </button>
    </div>

    <div class="confirmation-message" id="confirmationMessage">
        Journey confirmed! Redirecting to ticket...
    </div>

    <script>
        // Passcode and Auto-Lock Functionality
        const PASSCODE = "T9C9M10";
        let autoLockTimer;
        const LOCK_TIMEOUT = 3 * 60 * 60 * 1000; // 3 hours in milliseconds
        let currentBus = null;
        let currentFilter = 'all';
        let favorites = JSON.parse(localStorage.getItem('busFavorites')) || { buses: [], stops: [] };
        let journeyHistory = JSON.parse(localStorage.getItem('journeyHistory')) || [];

        // Complete bus route data
        const busRoutes = {
            "100": ["Drogheda Bus Station", "Monasterboice", "Collon", "Dunleer", "Castlebellingham", "Dundalk Bus Station"],
            "100X": ["Dublin Busáras", "Dublin Airport", "Drogheda", "Dundalk Bus Station"],
            "101": ["Dublin Busáras", "Dublin Airport", "Swords", "Balbriggan", "Drogheda Bus Station"],
            "101X": ["Dublin Busáras", "Dublin Airport", "Drogheda Bus Station"],
            "103": ["Dublin Busáras", "Blanchardstown SC", "Dunboyne", "Ratoath"],
            "103X": ["Dublin Busáras", "Blanchardstown SC", "Navan Bus Station"],
            "105": ["Blanchardstown SC", "Ashbourne", "Drogheda Bus Station"],
            "105X": ["Dublin Busáras", "Liffey Valley SC", "Fairyhouse Cross"],
            "107": ["Navan Bus Station", "Kingscourt"],
            "108": ["Kells Bus Station", "Bailieboro"],
            "109": [
                "Kells Ind Estate", "Father Mccullen Park", "Kells", "Kilmainham", "Bloomsbury Cross", 
                "Tankardstown", "Mitchells Cross", "Kells Road", "Blackwater Retail Park", "Navan", 
                "Abbey Road", "Ardboyne Hotel", "Kilcarn Bridge", "St Columbans", "Garlow Cross", 
                "Tara Cross", "Lismullen", "Old Ross Road", "Grange Hall", "Dunshaughlin", 
                "Dunshaughlin Ie", "The Willows", "Ballymurphy", "Bush Lane", "Rathbeggan", 
                "Porterstown Lane", "Fairyhouse Cross", "Msd Dunboyne", "Bracetown Park", 
                "The Fairways Apartments", "N3 Slip Road", "Parkway Station", "Navan Road", 
                "Phibsborough Po", "Mater Hospital, Berkeley Road", "O'Connell Street Upper", 
                "Dublin Busáras"
            ],
            "109A": [
                "Busáras", "Tower View", "Abbey Road", "Johnstown Centre", "Boyne View", 
                "St Columbans", "Garlow Cross", "Dunshaughlin", "Steeplechase Hill", 
                "Holy Trinity Church", "Ballybin Roundabout", "Ashbourne Centre", 
                "Ballybin Road", "Saint John's Wood Court", "Ashbourne Credit Union", 
                "Ashbourne", "Bourne Avenue", "Ashbourne Community College", "Hickey's Lane", 
                "Ratoath", "Dublin Airport", "Ninemile Stone", "DCU Collins Avenue"
            ],
            "109B": ["Dublin Busáras", "Trim"],
            "109X": ["Dublin Busáras", "Cavan Bus Station"],
            // ... (rest of bus routes remain exactly as before)
        };

        // Complete ticket prices data
        const ticketPrices = {
            "100": { "shortFare": 0.75, "standardFare": 1.00 },
            "100X": { "shortFare": 0.75, "standardFare": 1.00 },
            "101": { "shortFare": 0.75, "standardFare": 1.00 },
            "101X": { "shortFare": 0.75, "standardFare": 1.00 },
            "103": { "shortFare": 0.75, "standardFare": 1.00 },
            "103X": { "shortFare": 0.75, "standardFare": 1.00 },
            "105": { "shortFare": 0.75, "standardFare": 1.00 },
            "105X": { "shortFare": 0.75, "standardFare": 1.00 },
            "107": { "shortFare": 0.75, "standardFare": 1.00 },
            "108": { "shortFare": 0.75, "standardFare": 1.00 },
            "109": { "shortFare": 0.75, "standardFare": 1.00 },
            "109A": { "shortFare": 0.75, "standardFare": 1.00 },
            "109B": { "shortFare": 0.75, "standardFare": 1.00 },
            "109X": { "shortFare": 0.75, "standardFare": 1.00 },
            // ... (rest of ticket prices remain exactly as before)
        };

        function checkPasscode() {
            const input = document.getElementById('passcodeInput').value;
            const errorElement = document.getElementById('passcodeError');
            
            if (input === PASSCODE) {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                document.getElementById('appFooter').style.display = 'flex';
                sessionStorage.setItem('authenticated', 'true');
                resetAutoLockTimer();
            } else {
                errorElement.style.display = 'block';
                document.getElementById('passcodeInput').value = '';
            }
        }

        function resetAutoLockTimer() {
            if (autoLockTimer) {
                clearTimeout(autoLockTimer);
            }
            autoLockTimer = setTimeout(lockApp, LOCK_TIMEOUT);
        }

        function lockApp() {
            document.getElementById('lockScreen').style.display = 'flex';
            document.getElementById('appContent').style.display = 'none';
            document.getElementById('appFooter').style.display = 'none';
            document.getElementById('passcodeInput').value = '';
            document.getElementById('passcodeError').style.display = 'none';
            sessionStorage.removeItem('authenticated');
        }

        function checkInputFilled(fieldId) {
            const inputGroup = document.getElementById(`${fieldId}-group`);
            const inputField = document.getElementById(fieldId);
            
            if (inputField.value.trim() !== '') {
                inputGroup.classList.add('filled');
            } else {
                inputGroup.classList.remove('filled');
            }
            
            calculatePrice();
        }

        function populateBusOptions(filter = '') {
            const busOptionsContainer = document.getElementById('bus-options');
            const favoritesContainer = document.getElementById('favorites-container');
            const favoriteBusOptions = document.getElementById('favorite-bus-options');
            
            busOptionsContainer.innerHTML = '<div class="bus-option" onclick="selectBus(\'other\')">Other</div>';
            favoriteBusOptions.innerHTML = '';
            
            const hasFavorites = favorites.buses.length > 0;
            favoritesContainer.style.display = hasFavorites ? 'block' : 'none';
            
            Object.keys(busRoutes).forEach(busNumber => {
                if (filter && !busNumber.toLowerCase().includes(filter.toLowerCase())) {
                    return;
                }
                
                const isFavorite = favorites.buses.includes(busNumber);
                const busOption = createBusOption(busNumber, isFavorite);
                
                if (isFavorite) {
                    favoriteBusOptions.appendChild(busOption.cloneNode(true));
                }
                
                if (!filter || busNumber.toLowerCase().includes(filter.toLowerCase())) {
                    busOptionsContainer.appendChild(busOption);
                }
            });
        }

        function createBusOption(busNumber, isFavorite) {
            const busOption = document.createElement('div');
            busOption.className = `bus-option ${isFavorite ? 'favorite' : ''}`;
            busOption.dataset.busNumber = busNumber;
            busOption.innerHTML = `
                ${busNumber}
                <span class="star" onclick="toggleBusFavorite(event, '${busNumber}')">
                    ${isFavorite ? '★' : '☆'}
                </span>
            `;
            busOption.onclick = function() {
                selectBus(busNumber);
            };
            return busOption;
        }

        function selectBus(busNumber) {
            if (currentBus === busNumber) {
                currentBus = null;
                document.querySelectorAll('.bus-option').forEach(option => {
                    option.classList.remove('selected');
                    option.classList.remove('hidden');
                });
                return;
            }
            
            document.querySelectorAll('.bus-option').forEach(option => {
                option.classList.remove('selected');
                
                if (option.dataset.busNumber !== busNumber && 
                    !favorites.buses.includes(option.dataset.busNumber) &&
                    !(busNumber === 'other' && option.textContent.includes('Other'))) {
                    option.classList.add('hidden');
                } else {
                    option.classList.remove('hidden');
                }
            });
            
            const selectedOption = [...document.querySelectorAll('.bus-option')].find(option => 
                option.dataset.busNumber === busNumber || 
                (busNumber === 'other' && option.textContent.includes('Other'))
            );
            
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
            
            currentBus = busNumber;
            
            document.getElementById('origin-suggestions').innerHTML = '';
            document.getElementById('destination-suggestions').innerHTML = '';
            
            if (busNumber === 'other') {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€1.00';
            } else {
                document.getElementById('price-display').style.display = 'none';
            }
        }

        function filterRoutes() {
            const searchTerm = document.getElementById('route-search').value.toLowerCase();
            document.querySelectorAll('.bus-option').forEach(option => {
                const busNumber = option.dataset.busNumber || option.textContent;
                if (busNumber.toLowerCase().includes(searchTerm) {
                    option.classList.remove('hidden');
                } else {
                    option.classList.add('hidden');
                }
            });
        }

        function showSuggestedStops(type, query) {
            if (!currentBus || currentBus === 'other') return;
            
            const suggestionsContainer = document.getElementById(`${type}-suggestions`);
            suggestionsContainer.innerHTML = '';
            
            if (!query) return;
            
            const filteredStops = busRoutes[currentBus].filter(stop => 
                stop.toLowerCase().includes(query.toLowerCase())
            );
            
            filteredStops.forEach(stop => {
                const isFavorite = favorites.stops.includes(stop);
                const stopItem = document.createElement('div');
                stopItem.className = 'stop-item';
                stopItem.innerHTML = `
                    ${stop}
                    <span class="star ${isFavorite ? 'favorite' : ''}" 
                          onclick="toggleStopFavorite(event, '${stop}')">
                        ${isFavorite ? '★' : '☆'}
                    </span>
                `;
                stopItem.onclick = function() {
                    document.getElementById(type).value = stop;
                    suggestionsContainer.innerHTML = '';
                    checkInputFilled(type);
                    calculatePrice();
                };
                suggestionsContainer.appendChild(stopItem);
            });
        }

        function calculatePrice() {
            if (!currentBus || currentBus === 'other') {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€1.00';
                return;
            }
            
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            
            if (!origin || !destination) return;
            
            const distance = calculateDistance(origin, destination, currentBus);
            if (distance === null) {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('price-amount').textContent = '€1.00';
                return;
            }
            
            const isShortFare = distance <= 3;
            const price = isShortFare ? ticketPrices[currentBus].shortFare : ticketPrices[currentBus].standardFare;
            
            document.getElementById('price-amount').textContent = `€${price.toFixed(2)}`;
            document.getElementById('price-display').style.display = 'block';
        }

        function calculateDistance(origin, destination, busNumber) {
            const stops = busRoutes[busNumber];
            const originIndex = stops.indexOf(origin);
            const destinationIndex = stops.indexOf(destination);
            
            if (originIndex === -1 || destinationIndex === -1) return null;
            
            return Math.abs(destinationIndex - originIndex);
        }

        function toggleBusFavorite(event, busNumber) {
            event.stopPropagation();
            const index = favorites.buses.indexOf(busNumber);
            
            if (index === -1) {
                favorites.buses.push(busNumber);
            } else {
                favorites.buses.splice(index, 1);
            }
            
            localStorage.setItem('busFavorites', JSON.stringify(favorites));
            
            const starElement = event.target;
            starElement.textContent = index === -1 ? '★' : '☆';
            starElement.parentElement.classList.toggle('favorite');
            
            populateBusOptions(document.getElementById('route-search').value);
        }

        function toggleStopFavorite(event, stop) {
            event.stopPropagation();
            const index = favorites.stops.indexOf(stop);
            
            if (index === -1) {
                favorites.stops.push(stop);
            } else {
                favorites.stops.splice(index, 1);
            }
            
            localStorage.setItem('busFavorites', JSON.stringify(favorites));
            
            event.target.classList.toggle('favorite');
            event.target.textContent = index === -1 ? '★' : '☆';
        }

        function saveJourney() {
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const price = document.getElementById('price-amount').textContent;
            
            if (!currentBus || !origin || !destination) {
                alert('Please select a bus and both origin and destination');
                return;
            }
            
            const originFilled = document.getElementById('origin-group').classList.contains('filled');
            const destinationFilled = document.getElementById('destination-group').classList.contains('filled');
            
            if (!originFilled || !destinationFilled) {
                alert('Please complete both origin and destination fields');
                return;
            }
            
            // Show confirmation message
            const confirmationMessage = document.getElementById('confirmationMessage');
            confirmationMessage.style.display = 'block';
            
            // Save journey data
            localStorage.setItem('ticketOrigin', origin);
            localStorage.setItem('ticketDestination', destination);
            
            const journey = {
                bus: currentBus,
                origin: origin,
                destination: destination,
                price: price,
                date: new Date().toISOString(),
                completed: false
            };
            
            journeyHistory.unshift(journey);
            localStorage.setItem('journeyHistory', JSON.stringify(journeyHistory));
            
            // Redirect after delay
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                document.getElementById('appFooter').style.display = 'flex';
                resetAutoLockTimer();
            } else {
                document.getElementById('lockScreen').style.display = 'flex';
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('appFooter').style.display = 'none';
            }

            document.addEventListener('click', resetAutoLockTimer);
            document.addEventListener('keypress', resetAutoLockTimer);
            document.addEventListener('scroll', resetAutoLockTimer);
            document.addEventListener('mousemove', resetAutoLockTimer);

            const savedOrigin = localStorage.getItem('ticketOrigin');
            const savedDestination = localStorage.getItem('ticketDestination');
            
            if (savedOrigin) {
                document.getElementById('origin').value = savedOrigin;
                checkInputFilled('origin');
            }
            if (savedDestination) {
                document.getElementById('destination').value = savedDestination;
                checkInputFilled('destination');
            }

            populateBusOptions();
        });

        document.querySelector('.exit-arrow').addEventListener('click', function() {
            window.history.back();
        });
    </script>
</body>
</html>
